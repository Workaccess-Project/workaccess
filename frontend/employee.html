<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Workaccess – Detail zaměstnance</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div id="wa-nav"></div>

      <div class="section">
        <h1 style="font-size:18px;">Detail zaměstnance</h1>
        <div class="small"><a href="./employees.html" style="color:var(--accent); text-decoration:none;">← zpět na seznam</a></div>
      </div>

      <div class="section">
        <div id="state" class="small">Načítám…</div>
        <div id="box" style="margin-top:12px;"></div>
      </div>
    </div>
  </div>

  <script src="./js/wa_nav.js"></script>
  <script src="./js/api.js"></script>
  <script>
    WA_NAV.renderNav("employees");

    function getParam(name) {
      return new URLSearchParams(location.search).get(name);
    }

    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    (async () => {
      const id = getParam("id");
      if (!id) {
        document.getElementById("state").textContent = "Chybí parametr ?id=";
        return;
      }

      try {
        const e = await WA_API.getEmployee(id);
        document.getElementById("state").textContent = "Načteno ✅";

        document.getElementById("box").innerHTML = `
          <table class="table">
            <tbody>
              <tr><th style="width:220px;">ID</th><td>${escapeHtml(e.id ?? e.employeeId ?? e._id ?? id)}</td></tr>
              <tr><th>Jméno</th><td>${escapeHtml(e.name ?? e.fullName ?? "—")}</td></tr>
              <tr><th>Email</th><td>${escapeHtml(e.email ?? "—")}</td></tr>
              <tr><th>Oddělení</th><td>${escapeHtml(e.department ?? e.team ?? "—")}</td></tr>
              <tr><th>Role / pozice</th><td>${escapeHtml(e.role ?? e.position ?? "—")}</td></tr>
            </tbody>
          </table>

          <div class="small" style="margin-top:12px;">
            (Pozn.: Zobrazuju „best effort“ pole. Když máš v datech jiné názvy, upravíme mapování.)
          </div>
        `;
      } catch (err) {
        document.getElementById("state").textContent =
          "Nepodařilo se načíst detail. Zkontroluj endpoint /api/employees/:id";
        console.error(err);
      }
    })();
  </script>
</body>
</html>
