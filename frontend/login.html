<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Workaccess – Přihlášení (demo)</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#111a2e;
      --panel2:#0f172a;
      --text:#e8eefc;
      --muted:#9fb0d0;
      --border:rgba(255,255,255,0.10);
      --btn:#1f2a44;
      --btn2:#233255;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius:16px;
      --gap:14px;
      --ok:#2dd4bf;
      --warn:#fbbf24;
      --bad:#fb7185;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 20% 10%, rgba(45,212,191,0.12), transparent 60%),
                  radial-gradient(900px 600px at 90% 30%, rgba(251,191,36,0.10), transparent 60%),
                  var(--bg);
      color:var(--text);
      font-family:var(--font);
    }
    .wrap{ max-width:900px; margin:0 auto; padding:18px; }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.03), transparent 40%), var(--panel);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding: 14px 14px 10px 14px;
      border-bottom:1px solid var(--border);
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
    }
    .hd h1{ margin:0; font-size:18px; }
    .hint{ color:var(--muted); font-size:12px; line-height:1.35; max-width:520px; }
    .bd{ padding:14px; }
    label{ font-size:12px; color:var(--muted); display:block; margin-bottom:6px; }
    select, input{
      width:100%;
      background: var(--panel2);
      border:1px solid var(--border);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 10px;
      min-height: 40px;
      font-size: 14px;
      outline:none;
    }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .col{ flex:1; min-width:260px; }
    .btn{
      background: linear-gradient(180deg, var(--btn2), var(--btn));
      border:1px solid var(--border);
      color:var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 13px;
      cursor:pointer;
      min-height: 40px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    .btn:disabled{ opacity: 0.5; cursor: not-allowed; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px; border-radius: 999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,0.04);
      font-size: 12px; color: var(--muted);
    }
    .dot{ width:10px; height:10px; border-radius:999px; background: var(--warn); box-shadow: 0 0 0 3px rgba(251,191,36,0.15); }
    .dotOk{ background: var(--ok); box-shadow: 0 0 0 3px rgba(45,212,191,0.15); }
    .dotBad{ background: var(--bad); box-shadow: 0 0 0 3px rgba(251,113,133,0.15); }

    .note{ color: var(--muted); font-size: 12px; line-height: 1.45; }
    .box{
      border:1px solid var(--border);
      background: rgba(255,255,255,0.03);
      border-radius: 14px;
      padding: 12px;
      margin-top: 12px;
    }
    code{ color:#c7d2fe; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="hd">
        <div>
          <h1>Workaccess – Přihlášení (demo)</h1>
          <div class="hint">
            Tento login je zatím jen “výběr role”. Nastaví se <code>wa_role_key</code> do localStorage a přejdeš na dashboard.
            Neřeší hesla ani uživatele – je to příprava na budoucí reálné přihlášení.
          </div>
        </div>
        <div class="pill" title="Stav">
          <span id="dot" class="dot"></span>
          <span id="status">Čekám…</span>
        </div>
      </div>

      <div class="bd">
        <div class="row">
          <div class="col">
            <label for="roleSelect">Vyber roli</label>
            <select id="roleSelect">
              <option value="hr">HR</option>
              <option value="manager">Manažer</option>
              <option value="security">Bezpečnost</option>
              <option value="external">Externí</option>
            </select>
            <div class="note" style="margin-top:8px;">
              Role se ukládá do <code>wa_role_key</code> a používá se v hlavičce <code>x-role</code> u API.
            </div>
          </div>

          <div class="col">
            <label for="companyInput">Volitelně: předvybraná firma</label>
            <input id="companyInput" placeholder="Např. ACME s.r.o. (nebo nech prázdné)" />
            <div class="note" style="margin-top:8px;">
              Pokud vyplníš, uloží se do <code>wa_company_id</code> a dashboard se hned načte ve správné firmě.
            </div>
          </div>
        </div>

        <div class="row" style="margin-top:12px;">
          <button class="btn" id="btnLogin" type="button">Pokračovat na dashboard</button>
          <button class="btn" id="btnClear" type="button">Vyčistit kontext (firma + employee)</button>
          <button class="btn" id="btnShow" type="button">Ukázat aktuální stav</button>
        </div>

        <div class="box" id="boxState">
          <div style="font-weight:700; margin-bottom:6px;">Aktuální stav v localStorage</div>
          <div class="note" id="stateText">—</div>
        </div>

        <div class="note" style="margin-top:10px;">
          Tip: Až bude reálné přihlášení, tenhle soubor nahradíme loginem, který dostane uživatele z backendu
          a nastaví roli automaticky.
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== storage keys (sjednoceno s aplikací) =====
    const LS = {
      role: "wa_role_key",      // hr/manager/security/external
      companyId: "wa_company_id",
      employeeId: "wa_employee_id"
    };

    const el = {
      dot: document.getElementById("dot"),
      status: document.getElementById("status"),
      roleSelect: document.getElementById("roleSelect"),
      companyInput: document.getElementById("companyInput"),
      btnLogin: document.getElementById("btnLogin"),
      btnClear: document.getElementById("btnClear"),
      btnShow: document.getElementById("btnShow"),
      stateText: document.getElementById("stateText")
    };

    function setStatus(kind, text){
      el.status.textContent = text;
      el.dot.classList.remove("dotOk", "dotBad");
      if (kind === "ok") el.dot.classList.add("dotOk");
      if (kind === "bad") el.dot.classList.add("dotBad");
    }

    function readState(){
      const role = localStorage.getItem(LS.role);
      const company = localStorage.getItem(LS.companyId);
      const emp = localStorage.getItem(LS.employeeId);

      return {
        role: role ? String(role) : "(nenastaveno)",
        company: company ? String(company) : "(nenastaveno)",
        employee: emp ? String(emp) : "(nenastaveno)"
      };
    }

    function renderState(){
      const s = readState();
      el.stateText.innerHTML =
        `Role: <code>${escapeHtml(s.role)}</code><br>` +
        `Firma: <code>${escapeHtml(s.company)}</code><br>` +
        `Employee: <code>${escapeHtml(s.employee)}</code>`;
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function initFromStorage(){
      const role = String(localStorage.getItem(LS.role) || "external").toLowerCase();
      if (["hr","manager","security","external"].includes(role)) el.roleSelect.value = role;

      const company = String(localStorage.getItem(LS.companyId) || "");
      el.companyInput.value = company;

      renderState();
      setStatus("ok", "Připraveno");
    }

    el.btnShow.addEventListener("click", () => {
      renderState();
      setStatus("ok", "Zobrazen stav");
    });

    el.btnClear.addEventListener("click", () => {
      localStorage.removeItem(LS.companyId);
      localStorage.removeItem(LS.employeeId);
      el.companyInput.value = "";
      renderState();
      setStatus("ok", "Kontekst vyčištěn");
    });

    el.btnLogin.addEventListener("click", () => {
      const role = String(el.roleSelect.value || "external").toLowerCase();
      localStorage.setItem(LS.role, role);

      const company = String(el.companyInput.value || "").trim();
      if (company) localStorage.setItem(LS.companyId, company);
      else localStorage.removeItem(LS.companyId);

      renderState();
      setStatus("ok", "Uloženo → přechod na dashboard…");

      // přechod do aplikace
      window.location.href = "dashboard.html";
    });

    initFromStorage();
  </script>
</body>
</html>
